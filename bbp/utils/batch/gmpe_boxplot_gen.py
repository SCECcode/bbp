#!/usr/bin/env python
"""
Copyright 2010-2019 University Of Southern California

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

 http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.

Python version of Ronnie Kamai Matlab scripts to generate box
plots of the GMPE comparisons. Added pre-computed NGA-West 2
data and pass ranges into this script. No longer uses Matlab and no
longer needs to mine gmpe data files from the realizations.

NGA-West 2 data and ranges calculated for a vs30=500m/s
"""
from __future__ import division, print_function

# Import Python modules
import os
import sys
import glob
import optparse
import numpy as np
import matplotlib as mpl
if mpl.get_backend() != 'agg':
    mpl.use('Agg') # Disables use of Tk/X11
import matplotlib.pyplot as plt
import pylab

# Import plot config file
import plot_config

# --------------------------------------------------------------------------
# Some constants
# --------------------------------------------------------------------------
CODEBASES = ["gp", "ucsb", "sdsu", "exsim", "csm",
             "irikura_recipe_m1", "irikura_recipe_m2", "song"]
ALL_PERIODS = [0.010, 0.011, 0.012, 0.013, 0.015, 0.017, 0.020, 0.022, 0.025,
               0.029, 0.032, 0.035, 0.040, 0.045, 0.050, 0.055, 0.060, 0.065,
               0.075, 0.085, 0.100, 0.110, 0.120, 0.130, 0.150, 0.170, 0.200,
               0.220, 0.240, 0.260, 0.280, 0.300, 0.350, 0.400, 0.450, 0.500,
               0.550, 0.600, 0.650, 0.750, 0.850, 1.000, 1.100, 1.200, 1.300,
               1.500, 1.700, 2.000, 2.200, 2.400, 2.600, 2.800, 3.000, 3.500,
               4.000, 4.400, 5.000, 5.500, 6.000, 6.500, 7.500, 8.500, 10.000]

PERIODS = [0.010, 0.020, 0.029, 0.04, 0.05, 0.06, 0.075, 0.1,
           0.15, 0.2, 0.26, 0.3, 0.4, 0.5, 0.6, 0.75, 1, 1.5,
           2, 3, 4, 5, 6, 7.5, 10]

# NGA-WEST2

NGA2 = {}

NGA2["Tacpt"] = [0.01, 0.02, 0.03, 0.05, 0.075, 0.1, 0.15, 0.2, 0.25,
                 0.3, 0.4, 0.5, 0.75, 1, 1.5, 2, 3]

NGA2["Tave"] = [0.01, 0.02, 0.03, 0.05, 0.075, 0.1, 0.15, 0.2, 0.25,
                0.3, 0.4, 0.5, 0.75, 1, 1.5, 2, 3, 4, 5, 7.5, 10]

NGA2["Tnga"] = [0.01, 0.02, 0.03, 0.05, 0.075, 0.1, 0.15, 0.2, 0.25,
                0.3, 0.4, 0.5, 0.75, 1, 1.5, 2, 3, 4, 5, 7.5, 10]

NGA2["M55rvLo20"] = [0.056359724, 0.057044943, 0.063052985, 0.078978612,
                     0.101530703, 0.120119872, 0.13296784, 0.128546962,
                     0.117750264, 0.10564989, 0.081342995, 0.064121255,
                     0.036732153, 0.023337408, 0.010869471, 0.006085181,
                     0.00275199, 0.001625306, 0.001038724, 0.000349007,
                     0.000157345]

NGA2["M55rvHi20"] = [0.125504337, 0.127306539, 0.137189798, 0.164383634,
                     0.211322856, 0.250013776, 0.276755137, 0.267553659,
                     0.245743713, 0.23274815, 0.175957758, 0.136219582,
                     0.082829275, 0.054039265, 0.0250696, 0.014611802,
                     0.006641659, 0.003825281, 0.0025881, 0.000950908,
                     0.000509454]
NGA2["M55rvLo50"] = [0.015693551, 0.015856199, 0.017280531, 0.021608587,
                     0.02746741, 0.031602528, 0.036296461, 0.037982733,
                     0.036241044, 0.033239867, 0.026197056, 0.020834545,
                     0.012570198, 0.008180614, 0.003934713, 0.002213657,
                     0.001003148, 0.000597907, 0.000348378, 0.000117337,
                     0.0000529837]
NGA2["M55rvHi50"] = [0.039309261, 0.038862562, 0.040485273, 0.048195188,
                     0.062499718, 0.076073779, 0.082849381, 0.081310934,
                     0.078643278, 0.076182335, 0.057678974, 0.045034743,
                     0.028390863, 0.018236355, 0.008738747, 0.005040957,
                     0.002288209, 0.001321017, 0.000876422, 0.000354791,
                     0.000197533]
NGA2["M62ssLo20"] = [0.087999109, 0.089180062, 0.096010328, 0.115150386,
                     0.146038501, 0.172970911, 0.205608599, 0.211021311,
                     0.200417144, 0.183593925, 0.151808551, 0.126387094,
                     0.082732235, 0.059038042, 0.033635823, 0.022089442,
                     0.011925054, 0.007353834, 0.004339077, 0.001631526,
                     0.000794116]
NGA2["M62ssHi20"] = [0.183158615, 0.185616615, 0.199832918, 0.239670442,
                     0.303960005, 0.360016289, 0.427947359, 0.439213212,
                     0.417142026, 0.3821267, 0.315969609, 0.263058177,
                     0.172196308, 0.12287995, 0.070008559, 0.04597628,
                     0.024820438, 0.015699975, 0.010831109, 0.005254633,
                     0.002884952]
NGA2["M62ssLo50"] = [0.030580163, 0.030848717, 0.032972274, 0.03945978,
                     0.049770361, 0.059007081, 0.070906448, 0.073393616,
                     0.070852716, 0.066133238, 0.055633849, 0.046819229,
                     0.031434513, 0.022366469, 0.013023804, 0.008575046,
                     0.004623717, 0.002720029, 0.001608385, 0.000605917,
                     0.000295224]
NGA2["M62ssHi50"] = [0.063648603, 0.064207563, 0.068627468, 0.082130362,
                     0.103590486, 0.122815508, 0.147582482, 0.156381333,
                     0.150427109, 0.140306935, 0.116595216, 0.09744809,
                     0.06557241, 0.046863492, 0.027107343, 0.017847835,
                     0.009623661, 0.006200904, 0.004292134, 0.002207376,
                     0.001249165]
NGA2["M66ssLo20"] = [0.107744383, 0.109165193, 0.117586943, 0.140201037,
                     0.176854839, 0.20820012, 0.247372043, 0.25450452,
                     0.243911902, 0.225532754, 0.191719076, 0.162971956,
                     0.110251792, 0.081327671, 0.049388482, 0.034090455,
                     0.020477546, 0.013130027, 0.0082192, 0.003367838,
                     0.001731036]
NGA2["M66ssHi20"] = [0.224255816, 0.227213046, 0.244741816, 0.29181009,
                     0.368100177, 0.433341273, 0.514872497, 0.529717813,
                     0.507670667, 0.469416878, 0.399038138, 0.339204774,
                     0.22947466, 0.169272891, 0.102795655, 0.071435586,
                     0.042750461, 0.028767831, 0.020868348, 0.011856207,
                     0.006909831]
NGA2["M66ssLo50"] = [0.040622723, 0.040963868, 0.043831131, 0.05231201,
                     0.065605698, 0.077101819, 0.091977953, 0.095123949,
                     0.092540383, 0.08714561, 0.075095772, 0.064479136,
                     0.044790977, 0.03285474, 0.020391872, 0.014108398,
                     0.008439767, 0.005179811, 0.003248868, 0.00133351,
                     0.000685985]
NGA2["M66ssHi50"] = [0.084550876, 0.085260925, 0.091228756, 0.108880595,
                     0.136549666, 0.160477335, 0.191440059, 0.197988036,
                     0.192610682, 0.181382169, 0.15630201, 0.134204873,
                     0.093226551, 0.068382836, 0.042443011, 0.029364783,
                     0.017566268, 0.012096956, 0.00949278, 0.005997868,
                     0.003578109]
NGA2["M66rvLo20"] = [0.118593137, 0.120081238, 0.128933938, 0.152436184,
                     0.192932295, 0.228674723, 0.273098834, 0.282332092,
                     0.272745768, 0.253543599, 0.214588317, 0.181363137,
                     0.121740662, 0.089205456, 0.053477771, 0.036178557,
                     0.021099953, 0.013741723, 0.008608295, 0.003434744,
                     0.001748962]
NGA2["M66rvHi20"] = [0.246836078, 0.249933363, 0.268359099, 0.317275946,
                     0.401563294, 0.475956476, 0.568419443, 0.587637258,
                     0.567684581, 0.527717782, 0.446637466, 0.377483608,
                     0.253387237, 0.185669469, 0.111306973, 0.076091361,
                     0.045354516, 0.029474332, 0.020705292, 0.011856207,
                     0.006909831]
NGA2["M66rvLo50"] = [0.044454341, 0.044812694, 0.047826901, 0.056670166,
                     0.071372107, 0.084454269, 0.101120084, 0.10489642,
                     0.102773514, 0.097305128, 0.083444492, 0.071212325,
                     0.049044609, 0.035725784, 0.021893463, 0.014850093,
                     0.008634888, 0.005565883, 0.003402669, 0.001360002,
                     0.000693088]
NGA2["M66rvHi50"] = [0.092525887, 0.093271751, 0.099545428, 0.117951525,
                     0.14855169, 0.175780495, 0.210468207, 0.218328154,
                     0.213909604, 0.202527875, 0.173678777, 0.148219125,
                     0.102079928, 0.074358539, 0.045568376, 0.030908523,
                     0.017972388, 0.011947341, 0.00949278, 0.005997868,
                     0.003578109]

NGA2["number_of_models"] = 5
NGA2["lines"] = {}

# ASK14
NGA2["lines"][0] = {}
NGA2["lines"][0]['M55rv20'] = [0.078294115, 0.079933732, 0.083837743,
                               0.098060083, 0.126178875, 0.15302637,
                               0.18536572, 0.189314042, 0.170859393,
                               0.142992888, 0.105723299, 0.082809907,
                               0.04522314, 0.029595103, 0.016841282,
                               0.010544547, 0.004818515, 0.002752209,
                               0.00174853, 0.000782269, 0.00040493]
NGA2["lines"][0]['M55rv50'] = [0.023116427, 0.023570773, 0.024758022,
                               0.028927026, 0.036706894, 0.043886896,
                               0.052429419, 0.05381973, 0.049571615,
                               0.042750134, 0.033663115, 0.027251952,
                               0.015198342, 0.009946158, 0.005711094,
                               0.003608118, 0.001640174, 0.000927846,
                               0.000591064, 0.000286921, 0.000159]
NGA2["lines"][0]['M62ss20'] = [0.12254422, 0.124942656, 0.130297048,
                               0.150847868, 0.192403884, 0.232822794,
                               0.291700754, 0.311826583, 0.293903871,
                               0.254214065, 0.197217481, 0.161600864,
                               0.100232319, 0.070115276, 0.042661843,
                               0.028446373, 0.014969541, 0.009484945,
                               0.006573112, 0.003424394, 0.002003189]
NGA2["lines"][0]['M62ss50'] = [0.043199535, 0.044021362, 0.046115234,
                               0.053618891, 0.067755339, 0.080934191,
                               0.099637542, 0.106130917, 0.10131549,
                               0.090302329, 0.074611425, 0.063188104,
                               0.040023919, 0.027997837, 0.017189375,
                               0.011565277, 0.006054266, 0.003799318,
                               0.002640029, 0.001492334, 0.000934576]
NGA2["lines"][0]['M66ss20'] = [0.134751814, 0.137339117, 0.143003339,
                               0.165108565, 0.210117387, 0.254115854,
                               0.32259563, 0.351007869, 0.336749551,
                               0.298874402, 0.241037813, 0.204093093,
                               0.137460612, 0.100804946, 0.064707146,
                               0.045155289, 0.025925427, 0.017512459,
                               0.012800371, 0.007312398, 0.004598762]
NGA2["lines"][0]['M66ss50'] = [0.052450368, 0.053433073, 0.055906419,
                               0.064860422, 0.081808189, 0.09768103,
                               0.121872698, 0.132006081, 0.128104399,
                               0.117158707, 0.100630952, 0.088065626,
                               0.060572651, 0.044420163, 0.028771281,
                               0.020259291, 0.011570854, 0.007741131,
                               0.005673444, 0.003516647, 0.002367664]
NGA2["lines"][0]['M66rv20'] = [0.158173921, 0.161099414, 0.167252722,
                               0.192124993, 0.243485169, 0.294175301,
                               0.375030227, 0.411292226, 0.397160104,
                               0.348808626, 0.276705516, 0.231499156,
                               0.15222161, 0.109802953, 0.068914848,
                               0.047304594, 0.026555164, 0.017644296,
                               0.012723799, 0.007106937, 0.004396405]
NGA2["lines"][0]['M66rv50'] = [0.061740235, 0.062879229, 0.065709854,
                               0.076067806, 0.09576868, 0.114305309,
                               0.142885886, 0.155271435, 0.151085446,
                               0.136732913, 0.115521873, 0.09989127,
                               0.067077152, 0.048385176, 0.030642187,
                               0.021223594, 0.011851914, 0.007799408,
                               0.005639505, 0.003417837, 0.002263481]

# BSSA14
NGA2["lines"][1] = {}
NGA2["lines"][1]['M55rv20'] = [0.103200624, 0.102744349, 0.106384231,
                               0.127012869, 0.16894211, 0.201087789,
                               0.195724879, 0.167304181, 0.14318879,
                               0.124293989, 0.095697641, 0.075777356,
                               0.043214298, 0.027455774, 0.012787612,
                               0.007159036, 0.003237635, 0.001912125,
                               0.001291884, 0.000650001, 0.000376129]
NGA2["lines"][1]['M55rv50'] = [0.034181966, 0.033793532, 0.03461163,
                               0.040575852, 0.054347581, 0.066151112,
                               0.066635878, 0.058275829, 0.050645503,
                               0.04437217, 0.034384001, 0.027206581,
                               0.015506014, 0.009834329, 0.004629075,
                               0.002604303, 0.001180174, 0.00070342,
                               0.000478922, 0.000245534, 0.000137261]
NGA2["lines"][1]['M62ss20'] = [0.13467938, 0.133956003, 0.140430971,
                               0.168447169, 0.214530628, 0.258475285,
                               0.325619217, 0.343104753, 0.326252833,
                               0.302551523, 0.25118075, 0.210675662,
                               0.142745557, 0.102715435, 0.056535719,
                               0.035802956, 0.019596719, 0.012789451,
                               0.00908641, 0.004569246, 0.002508654]
NGA2["lines"][1]['M62ss50'] = [0.052287691, 0.051591468, 0.053477078,
                               0.062987096, 0.080536509, 0.098547992,
                               0.126932764, 0.135983768, 0.130806181,
                               0.12200603, 0.101387145, 0.08470802,
                               0.057019487, 0.040750863, 0.022564692,
                               0.01434802, 0.007866971, 0.005189683,
                               0.003714387, 0.001919458, 0.001034816]
NGA2["lines"][1]['M66ss20'] = [0.158202521, 0.157016139, 0.164250788,
                               0.195263539, 0.245322121, 0.291565201,
                               0.361733966, 0.380825687, 0.364318432,
                               0.340638705, 0.288018612, 0.24543194,
                               0.169868986, 0.124638055, 0.072676253,
                               0.048107491, 0.028360548, 0.019663579,
                               0.014629002, 0.007997478, 0.004637106]
NGA2["lines"][1]['M66ss50'] = [0.065830716, 0.064767755, 0.066963933,
                               0.078167612, 0.098455968, 0.118412809,
                               0.149218706, 0.15916656, 0.153698493,
                               0.144237433, 0.121660064, 0.103063318,
                               0.070602848, 0.051293771, 0.030015516,
                               0.019943534, 0.011778954, 0.008265977,
                               0.006196372, 0.003502493, 0.002011662]
NGA2["lines"][1]['M66rv20'] = [0.159344454, 0.157718647, 0.162355138,
                               0.189190321, 0.242522634, 0.296904644,
                               0.370448157, 0.389222271, 0.380316204,
                               0.36348208, 0.310189694, 0.261080301,
                               0.176113764, 0.128816124, 0.073937517,
                               0.047408466, 0.02610192, 0.017157795,
                               0.012406363, 0.00680793, 0.00386682]
NGA2["lines"][1]['M66rv50'] = [0.064379508, 0.063145127, 0.064226388,
                               0.073496755, 0.094502471, 0.117099992,
                               0.148381471, 0.157919907, 0.155700018,
                               0.149284678, 0.126970796, 0.106171415,
                               0.070809869, 0.051245156, 0.029515414,
                               0.019000378, 0.010484792, 0.006981404,
                               0.005089691, 0.002895511, 0.001628814]

# CB14
NGA2["lines"][2] = {}
NGA2["lines"][2]['M55rv20'] = [0.099467234, 0.101323627, 0.112183161,
                               0.139516188, 0.179276049, 0.208794488,
                               0.236334324, 0.227367831, 0.213690186,
                               0.202389696, 0.153006746, 0.11845181,
                               0.072025456, 0.046990665, 0.021799652,
                               0.012543499, 0.005602452, 0.003326331,
                               0.002250521, 0.000709564, 0.000395457]
NGA2["lines"][2]['M55rv50'] = [0.030038712, 0.030372282, 0.033231082,
                               0.040504836, 0.051837305, 0.06186335,
                               0.071990348, 0.07070516, 0.068385459,
                               0.066245509, 0.050155629, 0.039160646,
                               0.024687707, 0.0158577, 0.007598911,
                               0.004268376, 0.001906827, 0.001148711,
                               0.000762106, 0.000241396, 0.000132217]
NGA2["lines"][2]['M62ss20'] = [0.126712063, 0.128594278, 0.140707067,
                               0.177343818, 0.223477154, 0.257772028,
                               0.296672511, 0.295080756, 0.286191632,
                               0.272175215, 0.236372555, 0.196634904,
                               0.130312505, 0.094626698, 0.053451624,
                               0.036335715, 0.019847707, 0.013087038,
                               0.008906782, 0.003399929, 0.001909228]
NGA2["lines"][2]['M62ss50'] = [0.044746468, 0.045077284, 0.048775413,
                               0.060180485, 0.07494826, 0.087607432,
                               0.101702842, 0.102917705, 0.103097554,
                               0.100565991, 0.086710007, 0.072800271,
                               0.050125454, 0.035454563, 0.020542778,
                               0.013617682, 0.007393407, 0.004899792,
                               0.003267479, 0.001275688, 0.000712612]
NGA2["lines"][2]['M66ss20'] = [0.170529033, 0.173156473, 0.190278723,
                               0.240216224, 0.297057125, 0.335958226,
                               0.383154505, 0.383614074, 0.376055962,
                               0.359316016, 0.325440768, 0.275101871,
                               0.186669633, 0.141931358, 0.087252227,
                               0.062117901, 0.037174314, 0.024983154,
                               0.01722056, 0.007298294, 0.004212382]
NGA2["lines"][2]['M66ss50'] = [0.066252701, 0.066792831, 0.072683506,
                               0.090029016, 0.109713088, 0.124963706,
                               0.141969518, 0.143972638, 0.145720381,
                               0.14273755, 0.127325833, 0.108657518,
                               0.076694039, 0.05645426, 0.035456949,
                               0.024600487, 0.014580682, 0.009795704,
                               0.006613051, 0.002896024, 0.001674337]
NGA2["lines"][2]['M66rv20'] = [0.184351996, 0.18683454, 0.205315799,
                               0.254529085, 0.315706139, 0.360349661,
                               0.418206913, 0.424914844, 0.420244062,
                               0.406891303, 0.362603954, 0.304482679,
                               0.207383839, 0.157918303, 0.095967737,
                               0.066166401, 0.03943871, 0.025629854,
                               0.017367883, 0.007390299, 0.004318174]
NGA2["lines"][2]['M66rv50'] = [0.071860073, 0.072314062, 0.07873705,
                               0.095922947, 0.117345906, 0.134902018,
                               0.155821373, 0.1601446, 0.163311017,
                               0.16191583, 0.141874566, 0.120262113,
                               0.085204561, 0.062813187, 0.038998697,
                               0.02620381, 0.015468834, 0.01004927,
                               0.006669627, 0.002932532, 0.001716387]

# CY14
NGA2["lines"][3] = {}
NGA2["lines"][3]['M55rv20'] = [0.066305558, 0.067111697, 0.074179982,
                               0.095036673, 0.123416615, 0.142644764,
                               0.161400945, 0.164342848, 0.15810573,
                               0.146858551, 0.120613076, 0.097424616,
                               0.057295277, 0.036281706, 0.017756064,
                               0.010310636, 0.004418275, 0.002204635,
                               0.001222029, 0.000410596, 0.000185112]
NGA2["lines"][3]['M55rv50'] = [0.018463001, 0.018654351, 0.020330036,
                               0.025421867, 0.032314601, 0.037179445,
                               0.042701719, 0.044685568, 0.043863961,
                               0.041463067, 0.034992095, 0.028830157,
                               0.017476736, 0.011301324, 0.005709217,
                               0.003361906, 0.001469295, 0.000737549,
                               0.000409857, 0.000138043, 0.0000623338]
NGA2["lines"][3]['M62ss20'] = [0.121311405, 0.122727896, 0.135085752,
                               0.172257645, 0.221919125, 0.255093084,
                               0.286281106, 0.290477398, 0.277740593,
                               0.257882207, 0.217366154, 0.184302226,
                               0.123950547, 0.087317942, 0.050129077,
                               0.032714089, 0.015885821, 0.00865157,
                               0.005104797, 0.001919442, 0.000934254]
NGA2["lines"][3]['M62ss50'] = [0.040277237, 0.040661168, 0.044288779,
                               0.055645416, 0.070569967, 0.080455826,
                               0.089885224, 0.092037335, 0.088737939,
                               0.083155651, 0.071053618, 0.060923361,
                               0.041780535, 0.029927567, 0.017734921,
                               0.011771782, 0.005844054, 0.003200034,
                               0.001892218, 0.000712843, 0.000347322]
NGA2["lines"][3]['M66ss20'] = [0.139835103, 0.141296652, 0.154613881,
                               0.195910158, 0.25217984, 0.290792777,
                               0.328359244, 0.335055139, 0.322646636,
                               0.30178809, 0.25773635, 0.221182661,
                               0.153114203, 0.110698168, 0.066727504,
                               0.04580305, 0.025733845, 0.015447091,
                               0.009669647, 0.003962163 ,0.002036513]
NGA2["lines"][3]['M66ss50'] = [0.05117123, 0.051603313, 0.055986047,
                               0.070134114, 0.089039842, 0.101850955,
                               0.114029755, 0.116641223, 0.112678949,
                               0.105927347, 0.091002104, 0.078529457,
                               0.055097009, 0.040415029, 0.025138813,
                               0.017568777, 0.010100783, 0.006093895,
                               0.003822198, 0.001568836, 0.000807041]
NGA2["lines"][3]['M66rv20'] = [0.165222287, 0.167018995, 0.182744763,
                               0.231018774, 0.29636094, 0.341259538,
                               0.385374866, 0.393711481, 0.380085741,
                               0.356317691, 0.305152999, 0.262273674,
                               0.181926993, 0.131646982, 0.079392413,
                               0.054463201, 0.028971512, 0.016598209,
                               0.010127406, 0.004040875, 0.002057602]
NGA2["lines"][3]['M66rv50'] = [0.060589968, 0.061116781, 0.06630675,
                               0.082964517, 0.105147907, 0.120204501,
                               0.134588955, 0.137751276, 0.133316774,
                               0.125538394, 0.108056134, 0.093331271,
                               0.065550206, 0.048103527, 0.029926933,
                               0.020902627, 0.011373672, 0.006548098,
                               0.00400314, 0.001600002, 0.000815398]

# I14
NGA2["lines"][4] = {}
NGA2["lines"][4]['M55rv20'] = [0.087697354, 0.090097438, 0.09887849,
                               0.110084449, 0.134575561, 0.160928311,
                               0.180334348, 0.178941422, 0.163544512,
                               0.147204058, 0.114344701, 0.088073397,
                               0.052658956, 0.035432214, 0.017176806,
                               0.01008293, 0.004941357, 0.002730032,
                               0.001818643, 0.000743167, 0.000404006]
NGA2["lines"][4]['M55rv50'] = [0.024284319, 0.024948927, 0.027380493,
                               0.031602213, 0.038624648, 0.045673795,
                               0.05337671, 0.052649613, 0.048957336,
                               0.044944079, 0.03577697, 0.027840141,
                               0.017806012, 0.012071148, 0.006100439,
                               0.003627924, 0.001733859, 0.001022914,
                               0.00068694, 0.000308514, 0.000171768]
NGA2["lines"][4]['M62ss20'] = [0.129532319, 0.133077334, 0.146047282,
                               0.161737955, 0.201114312, 0.243558186,
                               0.28287894, 0.281707508, 0.261615167,
                               0.237527215, 0.192930277, 0.158476514,
                               0.099545998, 0.071094104, 0.039852915,
                               0.02604251, 0.015721297, 0.010398963,
                               0.007866661, 0.003986387, 0.002253587]
NGA2["lines"][4]['M62ss50'] = [0.040078316, 0.041175172, 0.045188175,
                               0.052210254, 0.065207191, 0.078100674,
                               0.093323535, 0.092353303, 0.087137148,
                               0.08102047, 0.067551194, 0.05610959,
                               0.037802688, 0.027209137, 0.015915124,
                               0.010553121, 0.00619437, 0.004401866,
                               0.003361288, 0.001876756, 0.00108623]
NGA2["lines"][4]['M66ss20'] = [0.173892963, 0.178652031, 0.196063768,
                               0.214838218, 0.271061525, 0.329414349,
                               0.388568754, 0.385359276, 0.359681877,
                               0.326257713, 0.270727258, 0.229784598,
                               0.148185133, 0.108582609, 0.064899461,
                               0.044726919, 0.030520137, 0.022095423,
                               0.018004602, 0.010309745, 0.006008548]
NGA2["lines"][4]['M66ss50'] = [0.057325989, 0.058894876, 0.064634872,
                               0.074160222, 0.094227991, 0.113263563,
                               0.13639001, 0.134387743, 0.127335535,
                               0.118561659, 0.101082536, 0.086802729,
                               0.060132058, 0.044413628, 0.027713707,
                               0.019398494, 0.012848775, 0.010028148,
                               0.008254591, 0.005215538, 0.003111399]
NGA2["lines"][4]['M66rv20'] = [0.188375998, 0.193531435, 0.212393344,
                               0.232731463, 0.293637445, 0.356850304,
                               0.420931506, 0.41745472, 0.389638726,
                               0.353430762, 0.293275338, 0.248922683,
                               0.160527038, 0.115296983, 0.067548058,
                               0.045630463, 0.031136684, 0.022095423,
                               0.018004602, 0.010309745, 0.006008548]
NGA2["lines"][4]['M66rv50'] = [0.062100503, 0.063800057, 0.070018121,
                               0.08033681, 0.102075964, 0.122696953,
                               0.147749534, 0.145580504, 0.137940939,
                               0.128436312, 0.109501404, 0.094032274,
                               0.065140281, 0.047160013, 0.028844724,
                               0.01979037, 0.013108337, 0.010028148,
                               0.008254591, 0.005215538, 0.003111399]

# Averages
NGA2["lines"]["avg"] = {}
NGA2["lines"]["avg"]['M55rv20'] = [0.086992977, 0.088242169, 0.095092722,
                                   0.113942052, 0.146477842, 0.173296344,
                                   0.191832043, 0.185454065, 0.169877722,
                                   0.152747836, 0.117877093, 0.092507417,
                                   0.054083425, 0.035151092, 0.017272283,
                                   0.01012813, 0.004603647, 0.002585067,
                                   0.001666321, 0.000659119, 0.000353127]
NGA2["lines"]["avg"]['M55rv50'] = [0.026016885, 0.026267973, 0.028062253,
                                   0.033406359, 0.042766206, 0.05095092,
                                   0.057426815, 0.05602718, 0.052284775,
                                   0.047954992, 0.037794362, 0.030057895,
                                   0.018134962, 0.011802132, 0.005949747,
                                   0.003494125, 0.001586066, 0.000908088,
                                   0.000585778, 0.000244082, 0.000132516]
NGA2["lines"]["avg"]['M62ss20'] = [0.126955878, 0.128659633, 0.138513624,
                                   0.166126891, 0.210689021, 0.249544276,
                                   0.296630506, 0.3044394, 0.289140819,
                                   0.264870045, 0.219013444, 0.182338034,
                                   0.119357385, 0.085173891, 0.048526236,
                                   0.031868329, 0.017204217, 0.010882393,
                                   0.007507552, 0.00345988, 0.001921782]
NGA2["lines"]["avg"]['M62ss50'] = [0.044117849, 0.044505291, 0.047568936,
                                   0.056928429, 0.071803453, 0.085129223,
                                   0.102296381, 0.105884605, 0.102218862,
                                   0.095410094, 0.080262678, 0.067545869,
                                   0.045350417, 0.032267993, 0.018789378,
                                   0.012371176, 0.006670614, 0.004298139,
                                   0.00297508, 0.001455416, 0.000823111]
NGA2["lines"]["avg"]['M66ss20'] = [0.155442287, 0.157492082, 0.1696421,
                                   0.202267341, 0.2551476, 0.300369281,
                                   0.35688242, 0.367172409, 0.351890492,
                                   0.325374985, 0.27659216, 0.235118832,
                                   0.159059713, 0.117331027, 0.071252518,
                                   0.04918213, 0.029542854, 0.019940341,
                                   0.014464836, 0.007376016, 0.004298662]
NGA2["lines"]["avg"]['M66ss50'] = [0.058606201, 0.05909837, 0.063234955,
                                   0.075470277, 0.094649016, 0.111234412,
                                   0.132696137, 0.137234849, 0.133507551,
                                   0.125724539, 0.108340298, 0.09302373,
                                   0.064619721, 0.04739937, 0.029419253,
                                   0.020354116, 0.012176009, 0.008384971,
                                   0.006111931, 0.003339907, 0.00199442]
NGA2["lines"]["avg"]['M66rv20'] = [0.171093731, 0.173240606, 0.186012353,
                                   0.219918927, 0.278342465, 0.329907889,
                                   0.393998334, 0.407319109, 0.393488967,
                                   0.365786092, 0.3095855, 0.261651699,
                                   0.175634649, 0.128696269, 0.077152115,
                                   0.052194625, 0.030440798, 0.019825115,
                                   0.014126011, 0.007131157, 0.00412951]
NGA2["lines"]["avg"]['M66rv50'] = [0.064134057, 0.064651051, 0.068999633,
                                   0.081757767, 0.102968185, 0.121841755,
                                   0.145885444, 0.151333544, 0.148270839,
                                   0.140381625, 0.120384955, 0.102737668,
                                   0.070756414, 0.051541412, 0.031585591,
                                   0.021424156, 0.01245751, 0.008281265,
                                   0.005931311, 0.003212284, 0.001907096]

NGA2["labels"] = ['ASK14', 'BSSA14', 'CB14', 'CY14', 'I14']
NGA2["acptThin"] = [3, 4, 5, 7.5, 10]

# 9 line colors in 'excel' colormap
RGB_XLS = [[0.96863, 0.58824, 0.27451],
           [0.50196, 0.39216, 0.77647],
           [0.60784, 0.73333, 0.34902],
           [0.75294, 0.31373, 0.30196],
           [0.58039, 0.54118, 0.32941],
           [0.29412, 0.67451, 0.77647],
           [0.30980, 0.50588, 0.74118],
           [0.12157, 0.28627, 0.49020],
           [0.45, 0.45, 0.45]]

COLOR_NGA = [0, 0, 0]

# --------------------------------------------------------------------------
# Functions
# --------------------------------------------------------------------------

def create_plot(codebase, mag, vel, dist, mech, sim_data, output_file):
    """
    This function creates a GMPE comparison plot
    Code was migrated from the Matlab script written by Ronnie.
    """
    # Set method name
    if codebase == 'gp':
        method_name = "Graves & Pitarka"
    elif codebase == 'sdsu':
        method_name = "SDSU"
    elif codebase == 'ucsb':
        method_name = "UCSB"
    elif codebase == 'exsim':
        method_name = "ExSIM"
    elif codebase == 'csm':
        method_name = "CSM"
    elif codebase == 'irikura_recipe_m1':
        method_name = "Irikura Recipe M1"
    elif codebase == 'irikura_recipe_m2':
        method_name = "Irikura Recipe M2"
    elif codebase == 'song':
        method_name = "Song"
    else:
        method_name = ""

    plot_title = ("%s, Scenario: M%.1f, %s, R=%d km, %s" %
                  (method_name, mag, mech, dist, vel))

    # Select model and lines, use NGA-W2
    nga = NGA2

    nga_lines = []
    nga_labels = nga["labels"]
    nga_periods = nga["Tnga"]
    nga_ave_periods = nga["Tave"]
    nga_acpt_thin = nga["acptThin"]

    if mech == "REV" and mag == 5.5 and dist == 20:
        acpt_x = nga["Tacpt"]
        acpt_lo = nga["M55rvLo20"]
        acpt_hi = nga["M55rvHi20"]
        nga_ave = nga["lines"]["avg"]["M55rv20"]
        for line in range(0, nga["number_of_models"]):
            nga_lines.append(nga["lines"][line]["M55rv20"])
    elif mech == "REV" and mag == 5.5 and dist == 50:
        acpt_x = nga["Tacpt"]
        acpt_lo = nga["M55rvLo50"]
        acpt_hi = nga["M55rvHi50"]
        nga_ave = nga["lines"]["avg"]["M55rv50"]
        for line in range(0, nga["number_of_models"]):
            nga_lines.append(nga["lines"][line]["M55rv50"])
    elif mech == "SS" and mag == 6.2 and dist == 20:
        acpt_x = nga["Tacpt"]
        acpt_lo = nga["M62ssLo20"]
        acpt_hi = nga["M62ssHi20"]
        nga_ave = nga["lines"]["avg"]["M62ss20"]
        for line in range(0, nga["number_of_models"]):
            nga_lines.append(nga["lines"][line]["M62ss20"])
    elif mech == "SS" and mag == 6.2 and dist == 50:
        acpt_x = nga["Tacpt"]
        acpt_lo = nga["M62ssLo50"]
        acpt_hi = nga["M62ssHi50"]
        nga_ave = nga["lines"]["avg"]["M62ss50"]
        for line in range(0, nga["number_of_models"]):
            nga_lines.append(nga["lines"][line]["M62ss50"])
    elif mech == "SS" and mag == 6.6 and dist == 20:
        acpt_x = nga["Tacpt"]
        acpt_lo = nga["M66ssLo20"]
        acpt_hi = nga["M66ssHi20"]
        nga_ave = nga["lines"]["avg"]["M66ss20"]
        for line in range(0, nga["number_of_models"]):
            nga_lines.append(nga["lines"][line]["M66ss20"])
    elif mech == "SS" and mag == 6.6 and dist == 50:
        acpt_x = nga["Tacpt"]
        acpt_lo = nga["M66ssLo50"]
        acpt_hi = nga["M66ssHi50"]
        nga_ave = nga["lines"]["avg"]["M66ss50"]
        for line in range(0, nga["number_of_models"]):
            nga_lines.append(nga["lines"][line]["M66ss50"])
    elif mech == "REV" and mag == 6.6 and dist == 20:
        acpt_x = nga["Tacpt"]
        acpt_lo = nga["M66rvLo20"]
        acpt_hi = nga["M66rvHi20"]
        nga_ave = nga["lines"]["avg"]["M66rv20"]
        for line in range(0, nga["number_of_models"]):
            nga_lines.append(nga["lines"][line]["M66rv20"])
    elif mech == "REV" and mag == 6.6 and dist == 50:
        acpt_x = nga["Tacpt"]
        acpt_lo = nga["M66rvLo50"]
        acpt_hi = nga["M66rvHi50"]
        nga_ave = nga["lines"]["avg"]["M66rv50"]
        for line in range(0, nga["number_of_models"]):
            nga_lines.append(nga["lines"][line]["M66rv50"])

    # Create arrays for sim_data mean and stddev
    sim_mean = []
    for data in sim_data:
        sim_mean.append(np.exp(np.mean(np.log(data))))

    box_positions = PERIODS
    box_width = 1.5 * 10.**(np.log10(PERIODS) - 1)

    # y axis
    ymin = 0.00006
    ymax = 4.0

    # Restore part of Matplotlib 1.x style
    mpl.rcParams['lines.linewidth'] = 1.0
    mpl.rcParams['lines.dashed_pattern'] = [6, 6]
    mpl.rcParams['lines.dashdot_pattern'] = [3, 5, 1, 5]
    mpl.rcParams['lines.dotted_pattern'] = [1, 3]
    mpl.rcParams['lines.scale_dashes'] = False
    mpl.rcParams['grid.color'] = 'k'
    mpl.rcParams['grid.linestyle'] = ':'
    mpl.rcParams['grid.linewidth'] = 0.5

    # Initialize plot
    fig, _ = plt.subplots()
    fig.clf()

    # Adjust margins
    fig.subplots_adjust(left=0.1)
    fig.subplots_adjust(right=0.97)
    fig.subplots_adjust(top=0.92)
    fig.subplots_adjust(bottom=0.07)

    # Array for labels
    l_handlers = []
    labels = nga_labels
    labels.append("Mean NGA Models")
    labels.append("Acceptance Criteria")

    # Plot NGA lines and average
    for line in range(0, len(nga_lines)):
        l_handlers.append(plt.plot(nga_periods, nga_lines[line],
                                   color=RGB_XLS[line], lw=1.8)[0])
    l_handlers.append(plt.plot(nga_ave_periods, nga_ave,
                               color=COLOR_NGA, lw=1.8)[0])
    # Plot acceptance criteria
    l_handlers.append(plt.plot(acpt_x, acpt_hi[0:len(acpt_x)],
                               color=COLOR_NGA, lw=2, ls='--')[0])
    plt.plot(acpt_x, acpt_lo[0:len(acpt_x)], color=COLOR_NGA, lw=2, ls='--')
    if len(nga_acpt_thin):
        plt.plot(nga_acpt_thin,
                 acpt_hi[len(acpt_hi)-len(nga_acpt_thin):len(acpt_hi)],
                 color=COLOR_NGA, lw=0.8, ls='--')
        plt.plot(nga_acpt_thin,
                 acpt_lo[len(acpt_lo)-len(nga_acpt_thin):len(acpt_lo)],
                 color=COLOR_NGA, lw=0.8, ls='--')
    # Now plot the data
    plt.boxplot(sim_data, positions=box_positions,
                widths=box_width, whis='range',
                boxprops=dict(linewidth=1.5, color='b'),
                whiskerprops=dict(linewidth=1.1,
                                  linestyle='-',
                                  color='k'))
    plt.scatter(box_positions, sim_mean, s=50, color='red', marker='o')

    plt.legend(l_handlers, labels, loc='lower left')
    plt.xscale('log')
    plt.yscale('log')
    plt.ylabel('PSA (g)')
    plt.xlabel('Period (sec)')
    plt.title(plot_title)
    plt.axis([0.01, 20, ymin, ymax])
    plt.xticks([0.01, 0.1, 1, 10], ["0.01", "0.1", "1", "10"])
    plt.grid(True)
    plt.grid(b=True, which='major', linestyle='-', color='lightgray')
    plt.grid(b=True, which='minor', linewidth=0.5, color='gray')
    plt.minorticks_on()

    # All done! Save plot!
    pylab.gcf().set_size_inches(10, 7.5)
    pylab.savefig(output_file, format="png", dpi=plot_config.dpi)

def load_sim_data(input_dir):
    """
    This function reads all simulation data from the rd50 files
    """
    # Create empty arrays for simulation data
    sim_data = []
    for _ in PERIODS:
        sim_data.append([])

    realizations = sorted(os.listdir(input_dir))
    for realization in realizations:
        basedir = os.path.join(input_dir, realization)
        stations = sorted(glob.glob("%s%s*.rd50" % (basedir, os.sep)))
        for station in stations:
            input_file = open(station, 'r')
            # Start with the first period
            cur_period_idx = 0
            for line in input_file:
                cur_period = PERIODS[cur_period_idx]
                line = line.strip()
                # Skip comments
                if line.startswith("#"):
                    continue
                pieces = [float(item) for item in line.split()]
                # Check if we want this period
                if pieces[0] == cur_period:
                    sim_data[cur_period_idx].append(pieces[3])
                    cur_period_idx = cur_period_idx + 1
            # Done with this file
            input_file.close()

    # Return simulation data
    return sim_data

# --------------------------------------------------------------------------
# Main
# --------------------------------------------------------------------------

def run():
    """
    Main part of the code
    """
    parser = optparse.OptionParser()
    parser.add_option("-d", "--dir", dest="input_dir",
                      help="Input directory containing simulation results")
    parser.add_option("-o", "--output", dest="output_dir",
                      help="Output directory for the plots")
    parser.add_option("-c", "--codebase", dest="codebase",
                      help="Codebase used in the simulation")
    parser.add_option("-m", "--mag", type="float", dest="mag",
                      help="Event Magnitude")
    parser.add_option("--dist", type="int", dest="dist",
                      help="Distance of the stations in km")
    parser.add_option("--mech", dest="mech",
                      help="Fault mechanism")
    parser.add_option("--vel", dest="vel",
                      help="Velocity model")
    (options, _) = parser.parse_args()


    if options.input_dir is None:
        parser.error("Please specify the input directory!")
    top_input_dir = options.input_dir
    if not os.path.isdir(top_input_dir):
        parser.error("Invalid input directory!")
    dirs = os.listdir(top_input_dir)
    if not "Sims" in dirs:
        parser.error("Please provide the top-level simulation directory!\n"
                     "This is the directory given to the cluster script")
    input_outdir = os.path.join(top_input_dir, "Sims", "outdata")
    # Validate codebase to use
    codebase = options.codebase
    if codebase is None:
        print("Please specify a codebase!")
        sys.exit(1)
    codebase = codebase.lower()
    if codebase not in CODEBASES:
        print("Codebase needs to be one of: %s" % (CODEBASES))
        sys.exit(1)
    if options.mag is None:
        parser.error("Please specify magnitude!")
    mag = float(options.mag)
    if options.mech is None:
        parser.error("Please specify fault mechanism!")
    mech = options.mech.upper()
    if options.dist is None:
        parser.error("Please specify station distance!")
    dist = int(options.dist)
    if options.vel is None:
        parser.error("Please specify velocity model!")
    vel = options.vel.upper()

    # Default is to use NGA-WEST2
    model_short = "w2"

    # Output filename
    r_output_file = ("boxplot_%s-gmpe%d%s%d-%s-%s.png" % (codebase,
                                                          int(mag * 10),
                                                          mech,
                                                          dist,
                                                          vel,
                                                          model_short))
    if options.output_dir is None:
        output_file = r_output_file
    else:
        output_file = os.path.join(options.output_dir, r_output_file)

    # Load simulation data
    sim_data = load_sim_data(input_outdir)

    # Create plot
    create_plot(codebase, mag, vel, dist, mech, sim_data, output_file)

    print("All Done!")

### Main
run()
